---
import { getCollection } from "astro:content";
import PublicationItem from "./PublicationItem.astro";

interface Props {
    filter?: string;
    title?: boolean;
}

const { filter, title = true } = Astro.props;

const allPapers = (
    await getCollection("publications", ({ data }) => {
        return filter ? data.areas.includes(filter) : true;
    })
).sort((a, b) => b.data.year - a.data.year);
const years = [...new Set(allPapers.map((p) => p.data.year))];
---

<div>
    {
        title && allPapers.length > 0 && (
            <div class="mb-10">
                <h2 class="mb-4">Publications</h2>
            </div>
        )
    }

    <div class="space-y-12">
        {
            years.map((year) => (
                <div class="relative">
                    <div class="sticky top-20 z-10 bg-white/90 backdrop-blur py-2 mb-4 border-b border-gray-100">
                        <h3>{year}</h3>
                    </div>
                    <div class="space-y-2">
                        {allPapers
                            .filter((p) => p.data.year === year)
                            .map((paper) => (
                                <PublicationItem entry={paper} />
                            ))}
                    </div>
                </div>
            ))
        }
    </div>
</div>
