---
import { Icon } from "astro-icon/components";
import { getCollection, type CollectionEntry } from "astro:content";

interface Props {
    entry: CollectionEntry<"theses">;
}

const members = await getCollection("team");

const { entry } = Astro.props;
const {
    title,
    types,
    topics,
    supervisors,
    externalSupervisors,
    start,
    added,
    order,
    assigned,
    student,
    pdf,
} = entry.data;

const typeStyles: Record<string, string> = {
    bachelor: "bg-emerald-50 text-emerald-700 border-emerald-100",
    master: "bg-blue-50 text-blue-700 border-blue-100",
    project: "bg-rose-50 text-rose-700 border-rose-100",
};

const formatType = (type: string) => {
    if (type === "bachelor") return "Bachelor";
    if (type === "master") return "Master";
    if (type === "project") return "Project";
};
---

<div
    class="group relative bg-white border border-gray-100 rounded-2xl overflow-hidden hover:shadow-lg transition-all duration-300"
>
    <div class="p-6 flex flex-col space-y-2">
        <!-- Title -->
        <h3 class="mb-3 group-hover:text-blue-600 transition-colors">
            {title}
        </h3>

        <!-- Start date / assigned student -->
        <div class="text-gray-600 text-sm leading-relaxed">
            {assigned ? <p>Student: {student}</p> : <p>Start: {start}</p>}
        </div>

        <!-- Types -->
        <div class="flex items-center flex-wrap gap-2 text-sm text-gray-500">
            {
                types.map((ty) => {
                    return (
                        <span
                            class={`px-2 py-0.5 rounded-full text-xs font-medium border flex items-center gap-1 ${typeStyles[ty]}`}
                        >
                            {formatType(ty)}
                        </span>
                    );
                })
            }
        </div>

        <!-- Supervisors -->
        <div class="mt-4">
            <p class="text-xs font-medium text-gray-500 mb-2">Supervisors</p>
            <div class="flex flex-wrap gap-2">
                {
                    supervisors.map((supervisor) => {
                        let member = members.find((m) => m.id.replace(/\.[^/.]+$/, "") === supervisor);
                        return (
                            <a
                                href={`/team/${supervisor}`}
                                class="inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium text-blue-700 bg-blue-50 border border-blue-200 rounded-lg hover:bg-blue-100 transition-all"
                            >
                                {member ? member.data.name : supervisor}
                            </a>
                        );
                    })
                }
                {
                    externalSupervisors?.map((supervisor) => (
                        <a
                            href={`mailto:${supervisor.email}`}
                            class="inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium text-blue-700 bg-blue-50 border border-blue-200 rounded-lg hover:bg-blue-100 transition-all"
                        >
                            {supervisor.name}
                        </a>
                    ))
                }
            </div>
        </div>

        <!-- Topics -->
        <div class="mt-3">
            <p class="text-xs font-medium text-gray-500 mb-2">Topics</p>
            <div class="flex flex-wrap gap-2">
                {
                    topics.map((topic) => {
                        return (
                            <span class="inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium text-gray-700 bg-gray-50 border border-gray-200 rounded-lg">
                                {topic}
                            </span>
                        );
                    })
                }
            </div>
        </div>

        <!-- pdf link -->
        <div>
            <a
                href={pdf}
                class="inline-flex items-center text-sm font-medium text-blue-600 hover:text-blue-700"
            >
                <span>Details</span>{" "}
                <Icon name="tabler:arrow-right" class="ml-1 w-4 h-4" />
            </a>
        </div>
    </div>
</div>
