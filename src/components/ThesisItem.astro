---
import { Icon } from "astro-icon/components";
import { getCollection, type CollectionEntry } from "astro:content";

interface Props {
    entry: CollectionEntry<"theses">;
}

const members = await getCollection("team");

const { entry } = Astro.props;
const {
    title,
    types,
    topics,
    supervisors,
    externalSupervisors,
    start,
    added,
    order,
    assigned,
    student,
    pdf,
} = entry.data;

const typeStyles: Record<string, string> = {
    bachelor: "bg-emerald-50 text-emerald-700 border-emerald-100",
    master: "bg-blue-50 text-blue-700 border-blue-100",
    project: "bg-rose-50 text-rose-700 border-rose-100",
};

const formatType = (type: string) => {
    if (type === "bachelor") return "Bachelor";
    if (type === "master") return "Master";
    if (type === "project") return "Project";
};
---

<div
    class="group relative bg-white border-2 border-gray-200 hover:border-blue-400 rounded-2xl overflow-hidden hover:shadow-lg transition-all duration-300 h-full flex flex-col"
>
    <div class="p-6 flex flex-col flex-1">
        <!-- Title -->
        <h3 class="mb-3 group-hover:text-blue-600 transition-colors line-clamp-2 min-h-[3.5rem]" title={title}>
            {title}
        </h3>

        <!-- Start date / assigned student -->
        <div class="text-gray-600 text-sm leading-relaxed mb-2">
            {assigned ? <p>Student: {student}</p> : <p>Start: {start}</p>}
        </div>

        <!-- Types -->
        <div class="flex items-center flex-wrap gap-2 text-sm text-gray-500 mb-4">
            {
                types.map((ty) => {
                    return (
                        <span
                            class={`px-2 py-0.5 rounded-full text-xs font-medium border flex items-center gap-1 ${typeStyles[ty]}`}
                        >
                            {formatType(ty)}
                        </span>
                    );
                })
            }
        </div>

        <!-- Supervisors -->
        <div class="mb-4 flex-1">
            <p class="text-xs font-medium text-gray-500 mb-2">Supervisors</p>
            <div class="flex flex-wrap gap-x-3 gap-y-1">
                {
                    supervisors.map((supervisor) => {
                        let member = members.find((m) => m.id.replace(/\.[^/.]+$/, "") === supervisor);
                        return (
                            <a
                                href={`/team/${supervisor}`}
                                class="text-base font-semibold text-blue-600 hover:text-blue-800 underline decoration-2 underline-offset-2 decoration-blue-300 hover:decoration-blue-600 transition-all duration-200 hover:scale-105 inline-block"
                            >
                                {member ? member.data.name : supervisor}
                            </a>
                        );
                    })
                }
                {
                    externalSupervisors?.map((supervisor) => (
                        <a
                            href={`mailto:${supervisor.email}`}
                            class="text-base font-semibold text-blue-600 hover:text-blue-800 underline decoration-2 underline-offset-2 decoration-blue-300 hover:decoration-blue-600 transition-all duration-200 hover:scale-105 inline-block"
                        >
                            {supervisor.name}
                        </a>
                    ))
                }
            </div>
        </div>

        <!-- Topics -->
        <div class="mb-4">
            <p class="text-xs font-medium text-gray-500 mb-2">Topics</p>
            <div class="flex flex-wrap gap-2">
                {
                    topics.map((topic) => {
                        return (
                            <span class="inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium text-gray-600 bg-gray-50 rounded-md">
                                {topic}
                            </span>
                        );
                    })
                }
            </div>
        </div>

        <!-- pdf link -->
        <div class="mt-auto pt-4">
            <a
                href={pdf}
                class="inline-flex items-center text-sm font-medium text-blue-600 hover:text-blue-700"
            >
                <span>Details</span>{" "}
                <Icon name="tabler:arrow-right" class="ml-1 w-4 h-4" />
            </a>
        </div>
    </div>
</div>
