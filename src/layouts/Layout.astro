---
import { Icon } from "astro-icon/components";
import "../styles/global.css";
import Header from "../components/Header.astro";
import { SITE } from "../config";
import ExternalLink from "../components/ExternalLink.astro";

interface Props {
  title?: string;
  description?: string;
}

const { title, description = SITE.description } = Astro.props;
const pageTitle = title
  ? `${title} | ${SITE.labName}`
  : `${SITE.labName} - ${SITE.university}`;

// Define dynamic OG Image
// If it's the homepage, use index.png. Otherwise, try to map the path to a slug.
// For simplification, we'll just default to index.png for the home page, and generate specific ones for known routes.
// However, to be robust, let's assume we have an og image for every page that maps to our static paths in og/[...slug].ts.
// But standard pages like /research match /og/research.
// What about nested pages like /research/cv? Our OG generator doesn't handle them yet (it only has static pages list).
// So we will use a fallback.
const currentPath = Astro.url.pathname.replace(/^\/|\/$/g, "");
const ogSlug = currentPath === "" ? "index" : currentPath;
// Check if the current path is one of our supported OG pages (index, research, team, publications, news, join).
// If not, fallback to index.
const supportedOgPages = [
  "index",
  "research",
  "team",
  "publications",
  "news",
  "join",
];
const finalOgSlug = supportedOgPages.includes(ogSlug) ? ogSlug : "index";
const ogImage = new URL(`/og/${finalOgSlug}.png`, Astro.url);
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self'; connect-src 'self';"
    />
    <meta name="google-site-verification" content="lJIJh-L2sKts2uOY4uk6yDSHZ1MJ46wmXyes2f2CLyo" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width" />
    <!-- <link rel="icon" type="image/svg+xml" href="/favicon.svg" /> -->
    <link rel="icon" href="/favicon.ico" sizes="any">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest">
    <meta name="generator" content={Astro.generator} />

    <title>{pageTitle}</title>

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={Astro.url} />
    <meta property="og:title" content={pageTitle} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={ogImage} />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={Astro.url} />
    <meta property="twitter:title" content={pageTitle} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={ogImage} />

    {
      Astro.url.pathname === "/" && (
        <script
          is:inline
          type="application/ld+json"
          set:html={JSON.stringify({
            "@context": "https://schema.org",
            "@type": "Person",
            name: SITE.author,
            url: SITE.website,
            image: new URL(SITE.avatar || SITE.logo, SITE.website).href,
            jobTitle: "Principal Investigator",
            worksFor: {
              "@type": "Organization",
              name: SITE.labName,
              url: SITE.website,
            },
            description: SITE.description,
          })}
        />
      )
    }
  </head>
  <body class="min-h-screen flex flex-col">
    <Header />
    <main class="flex-grow">
      <slot />
    </main>

    <footer class="border-t border-gray-100 py-8 mt-12 bg-gray-50">
      <div class="max-w-4xl mx-auto px-4 grid sm:grid-cols-1 md:grid-cols-2 gap-8">
        <div class="flex flex-col gap-2 text-center">
          <div class="flex gap-2 justify-center">
            <a
              href="https://github.com/ALRhub"
              target="_blank"
              class="inline-flex items-center gap-1.5 px-3 py-1 text-xs font-medium text-gray-600 border border-gray-200 rounded-md hover:text-blue-600 hover:border-blue-200 hover:bg-blue-50 transition-all"
            >
              <Icon name="simple-icons:github" /> ALRhub
            </a>
            <a
              href="https://www.linkedin.com/company/alr-kit"
              target="_blank"
              class="inline-flex items-center gap-1.5 px-3 py-1 text-xs font-medium text-gray-600 border border-gray-200 rounded-md hover:text-blue-600 hover:border-blue-200 hover:bg-blue-50 transition-all"
            >
              <Icon name="simple-icons:linkedin" /> alr-kit
            </a>
          </div>
          <div>
            <p class="info-text">
              <ExternalLink href="https://alr.iar.kit.edu/">University Homepage</ExternalLink>
            </p>
          </div>
          <div>
            <p class="info-text">
              <a href="/impressum" class="hover:text-blue-600 transition-colors">Impressum</a>
            </p>
            <p class="info-text">
              <a href="/datenschutz" class="hover:text-blue-600 transition-colors">Datenschutzerklärung</a>
            </p>
          </div>
          <div><p class="info-text">© 2026 Autonomous Learning Robots Lab</p></div>
        </div>
        <div class="text-center">
          <p class="info-text">
            <strong>Autonomous Learning Robots Lab</strong><br />
            Karlsruhe Institute of Technology<br />
            <ExternalLink href="https://maps.app.goo.gl/u5qThpsuWSW8jZ2n7"
              >InformatiKOM 1 (4th floor)</ExternalLink
            ><br />
            Adenauerring 12 <br />
            76131 Karlsruhe <br />
            Germany <br />
          </p>
        </div>
      </div>
    </footer>
  </body>
</html>
